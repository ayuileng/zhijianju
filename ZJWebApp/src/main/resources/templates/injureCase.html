<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>产品伤害案例库</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"/>
    <style type="text/css">
        .wrapper {
            margin-top: 60px;
        }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>
<div class="container wrapper">
    <div><a href="/chart/injureChart">统计图表</a></div>
    <div>
        <form action="/injurecase" th:object="${injureCaseForm}" class="form-horizontal">
            <div class="form-group">
                <label for="productName" class="col-md-2" style="text-align: right; margin-top: 7px">产品名称</label>
                <div class="col-md-2">
                    <input id="productName" class="form-control" type="text" th:value="*{productName}" name="productName" />
                </div>

                <label for="injureType" class="col-md-2" style="text-align: right; margin-top: 7px">伤害类别</label>
                <div class="col-md-2">
                    <input id="injureType" class="form-control" type="text" th:value="*{injureType}" name="injureType" />
                </div>

                <label for="province" class="col-md-2" style="text-align: right; margin-top: 7px">发生地点</label>
                <div class="col-md-2">
                    <select class="form-control" id="province" name="province" >
                        <option value="" th:selected="${injureCaseForm.province} == ''">全国</option>
                        <option value="北京" th:selected="${injureCaseForm.province} == '北京'">北京</option>
                        <option value="上海" th:selected="${injureCaseForm.province} == '上海'">上海</option>
                        <option value="重庆" th:selected="${injureCaseForm.province} == '重庆'">重庆</option>
                        <option value="天津" th:selected="${injureCaseForm.province} == '天津'">天津</option>
                        <option value="江苏" th:selected="${injureCaseForm.province} == '江苏'">江苏</option>
                        <option value="河北" th:selected="${injureCaseForm.province} == '河北'">河北</option>
                        <option value="山西" th:selected="${injureCaseForm.province} == '山西'">山西</option>
                        <option value="辽宁" th:selected="${injureCaseForm.province} == '辽宁'">辽宁</option>
                        <option value="吉林" th:selected="${injureCaseForm.province} == '吉林'">吉林</option>
                        <option value="黑龙江" th:selected="${injureCaseForm.province} == '黑龙江'">黑龙江</option>
                        <option value="浙江" th:selected="${injureCaseForm.province} == '浙江'">浙江</option>
                        <option value="安徽" th:selected="${injureCaseForm.province} == '安徽'">安徽</option>
                        <option value="福建" th:selected="${injureCaseForm.province} == '福建'">福建</option>
                        <option value="江西" th:selected="${injureCaseForm.province} == '江西'">江西</option>
                        <option value="山东" th:selected="${injureCaseForm.province} == '山东'">山东</option>
                        <option value="广东" th:selected="${injureCaseForm.province} == '广东'">广东</option>
                        <option value="河南" th:selected="${injureCaseForm.province} == '河南'">河南</option>
                        <option value="湖北" th:selected="${injureCaseForm.province} == '湖北'">湖北</option>
                        <option value="湖南" th:selected="${injureCaseForm.province} == '湖南'">湖南</option>
                        <option value="广东" th:selected="${injureCaseForm.province} == '广东'">广东</option>
                        <option value="四川" th:selected="${injureCaseForm.province} == '四川'">四川</option>
                        <option value="贵州" th:selected="${injureCaseForm.province} == '贵州'">贵州</option>
                        <option value="云南" th:selected="${injureCaseForm.province} == '云南'">云南</option>
                        <option value="陕西" th:selected="${injureCaseForm.province} == '陕西'">陕西</option>
                        <option value="甘肃" th:selected="${injureCaseForm.province} == '甘肃'">甘肃</option>
                        <option value="青海" th:selected="${injureCaseForm.province} == '青海'">青海</option>
                        <option value="台湾" th:selected="${injureCaseForm.province} == '台湾'">台湾</option>
                        <option value="内蒙" th:selected="${injureCaseForm.province} == '内蒙'">内蒙</option>
                        <option value="广西" th:selected="${injureCaseForm.province} == '广西'">广西</option>
                        <option value="西藏" th:selected="${injureCaseForm.province} == '西藏'">西藏</option>
                        <option value="宁夏" th:selected="${injureCaseForm.province} == '宁夏'">宁夏</option>
                        <option value="新疆" th:selected="${injureCaseForm.province} == '新疆'">新疆</option>
                        <option value="香港" th:selected="${injureCaseForm.province} == '香港'">香港</option>
                        <option value="澳门" th:selected="${injureCaseForm.province} == '澳门'">澳门</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="area" class="col-md-2" style="text-align: right; margin-top: 7px">地区</label>
                <div class="col-md-2">
                    <input id="area" class="form-control" type="text" th:value="*{area}" name="area" />
                </div>

                <label for="injureDegree" class="col-md-2" style="text-align: right; margin-top: 7px">伤害程度</label>
                <div class="col-md-2">
                    <input id="injureDegree" class="form-control" type="text" th:value="*{injureDegree}" name="injureDegree" />
                </div>

                <label for="dateFrom" class="col-md-2" style="text-align: right; margin-top: 7px">起始日期</label>
                <div class="col-md-2">
                    <input type="date" class="form-control" id="dateFrom" name="datefrom" th:value="*{datefrom}" />
                </div>
            </div>
            <div class="form-group">
                <label for="dateTo" class="col-md-2" style="text-align: right; margin-top: 7px">截至日期</label>
                <div class="col-md-2">
                    <input type="date" class="form-control" id="dateTo" name="dateto" th:value="*{dateto}" />
                </div>

                <label for="sort" class="col-md-2" style="text-align: right; margin-top: 7px">排序方式</label>
                <div class="col-md-2">
                    <select class="form-control" id="sort" name="sort" th:value="*{sort}" >
                        <option value="1" th:selected="${injureCaseForm.sort} == 1">发生时间升序</option>
                        <option value="2" th:selected="${injureCaseForm.sort} == 2">发生时间降序</option>
                        <option value="3" th:selected="${injureCaseForm.sort} == 3">严重程度升序</option>
                        <option value="4" th:selected="${injureCaseForm.sort} == 4">严重程度降序</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-offset-5 col-md-2">
                    <input class="btn btn-primary" type="submit" value="搜索"/>
                </div>
            </div>
            <div th:inline="text">共检索到[[${{injureCases.totalElements}}]]条案例！</div>
            <table class="table table-hover table-bordered table-striped">
                <tr>
                    <th>产品名称</th>
                    <th>伤害发生时间</th>
                    <th>伤害发生地点</th>
                    <th>伤害类别</th>
                    <th>伤害程度</th>
                </tr>
                <tr th:each="i : ${injureCases.content}"
                    th:if="${i.productName != null and ! #strings.isEmpty(i.productName)}">
                    <td><a target="_blank" th:href="${i.url}" th:text="${i.productName}"></a></td>
                    <td th:text="${#dates.format(i.injureTime, 'yyyy-MM-dd')}">1</td>
                    <td th:text="${i.injureArea}">1</td>
                    <td th:text="${i.injureType}">1</td>
                    <td>
                        <span th:if="${i.injureDegree} eq '1'" th:text="一级伤害"></span>
                        <span th:if="${i.injureDegree} eq '2'" th:text="二级伤害"></span>
                        <span th:if="${i.injureDegree} eq '3'" th:text="三级伤害"></span>
                    </td>
                </tr>
            </table>


            <!--todo pagingnation-->
            <div class="container paging">
                <!--分页组件-->
                <nav aria-label="Page navigation" th:object="${injureCases}">
                    <ul class="pagination">
                        <li class="page-item disabled">
                            <span>共<span th:text="${injureCases.totalPages}">1</span>页</span>
                        </li>
                        <!--当前页-->
                        <li class="page-item disabled">
                            <span th:inline="text">当前页码：[[${injureCases.number}+1]]</span>
                        </li>
                        <!--前往-->
                        <li class="page-item">
                            输入页码：<input type="text" name="page" th:value="${injureCaseForm.page}"/>
                            <input type="submit" value="前往"/>
                        </li>
                        <!--上一页-->
                        <li class="page-item" th:classappend="${injureCases.isFirst()} ? 'disabled' : ''">
                            <a id="prev" class="page-link" aria-label="Previous">
                                <span aria-hidden="true">←</span>
                            </a>
                        </li>

                        <!--下一页-->
                        <li class="page-item" th:classappend="${injureCases.isLast()} ? 'disabled' : ''">
                            <a id="next" class="page-link" aria-label="Next">
                                <span aria-hidden="true">→</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </form>
    </div>
</div>

<div th:replace="fragments/footer :: footer">...</div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script charset="uft-8" th:inline='javascript'>//<![CDATA[
function getUrlParam(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
    var r = window.location.search.substr(1).match(reg);  //匹配目标参数
    if (r != null) return decodeURI(r[2]);
    return null; //返回参数值
}

var productName = [[${injureCaseForm.productName}]];
var province = [[${injureCaseForm.province}]];
var injureDegree = [[${injureCaseForm.injureDegree}]];
var area = [[${injureCaseForm.area}]];
var injureType = [[${injureCaseForm.injureType}]];
var sort = [[${injureCaseForm.sort}]];
var page = [[${injureCaseForm.page}]];
function getString(s) {
    if(s == null||s.length == 0){
        return ""
    }
};
productName = getString(productName);
province = getString(province);
injureDegree = getString(injureDegree);
area = getString(area);
injureType = getString(injureType);
var datefrom = getUrlParam("datefrom");
var dateto = getUrlParam("dateto");

nextPage = Number(page) + 1;
prevPage =Number(page) - 1;

var path = window.location.pathname;
var requestParam = "?province="
    + province + "&injureDegree=" + injureDegree + "&datefrom=" + datefrom
    + "&dateto=" + dateto + "&productName=" + productName + "&area=" + area
    + "&injureType=" + injureType +"&sort="+sort+"&page=";
//productName=&injureType=&province=&area=&injureDegree=&datefrom=&dateto=&sort=2&page=0
$(".content > td > a").each(function (index) {
    $(this).attr("href", path + requestParam + $(this).attr("id"));
});

$("#next").attr("href", path + requestParam + nextPage);
if (prevPage <= 0) {
    prevPage = 1;
}
$("#prev").attr("href", path + requestParam + prevPage);
//]]></script>
</html>